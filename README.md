### Introduction  
This document describes `recognition_nsp.lua`, a Wireshark plugin written in Lua. This tool is designed to recognize data flows generated by calls and video calls made through applications such as Telegram, WhatsApp, Teams, Meet, and Zoom.  
These applications use many protocols, including the STUN protocol, which is used to establish connections between users (as it allows a host to know its public address).  
STUN packets enabled the development of this plugin, as the identification of these non-standard protocols relies on analyzing the various fields within the STUN layer.

### Description  
The `recognition_nsp.lua` plugin is based on a post-dissector, a specific type of Wireshark dissector responsible for analyzing packets. This plugin specifically focuses on analyzing UDP packets since the previously mentioned applications mainly use the UDP transport protocol for data transmission.  
For each UDP packet, `recognition_nsp.lua` begins by checking if the packet is a STUN packet. If it is, the packet is further analyzed to determine which non-standard protocol it represents. The flow, identified by source IP, source port, destination IP, and destination port, is then registered in the `flows_table`. If the packet is not a STUN packet, the plugin checks if it belongs to an already recognized flow by searching for it in the `flows_table`.  
After completing the analysis of a packet, information such as the name of the identified non-standard protocol is inserted into Wireshark's dissector tree. This allows you to see the information in the **Packet List** of Wireshark.

### Prerequisites  
- Have Wireshark installed on your PC.

### Instructions  
#### Adding a Column to the Packet List  

**Loading the Plugin**  
1. **Loading the script from the Terminal**  
   - **Find the Wireshark Plugin Folder**  
   Wireshark automatically loads Lua scripts from its plugin directory. Hereâ€™s where you can find this directory on different operating systems:  
     - **Windows:** `C:\Program Files\Wireshark\plugins\<version>\`  
     - **macOS:** `/Applications/Wireshark.app/Contents/PlugIns/wireshark/<version>/`  
     - **Linux:** `/usr/lib/wireshark/plugins/<version>/`  

2. **Copy the Lua Script to the Plugin Folder**  
   Copy your Lua script (`recognition_nsp.lua`) into Wireshark's plugin directory. If you're using the personal directory, ensure it exists and create the "plugins" folder if necessary.

**Loading the Lua Script via Wireshark GUI**  
1. Restart Wireshark.  
2. In Wireshark:  
   - Go to **Edit**.  
   - Click on **Preferences**.  
   - Click on **Columns**.  
   - Add a new column by pressing the **+**.  
   - Select the checkbox for the newly created row.  
   - In the **Title** column, type **Application Protocol**.  
   - In the **Type** column, select **Custom**.  
   - In the **Fields** column, type `l7.proto`.  
   - Click **Ok**.

#### Testing  
To test the plugin, pcap files are available in the `test_pcap` folder.  
Close Wireshark and reopen it to load the new Lua script. This action must be done independently of the loading method used.
